<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Visual Testing — Figma vs Stage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel="stylesheet" href="/static/header.css" />
  <link rel="stylesheet" href="/static/loader.css" />
  <link rel="stylesheet" href="/static/issues.css" />
  <link rel="stylesheet" href="/static/toggle.css" />
  <link rel="stylesheet" href="/static/file_upload.css" />
</head>

<body>
  <header>
    <nav>
      <a href="/" id="nav-run" class="active">Visual Testing</a>
      <a href="/broken-links">Broken Links</a>
      <a href="/accessibility">Accessibility</a>
      <a href="/seo-performance">SEO & Performance</a>
      <button id="nav-jira" class="btn-secondary"
        style="font-size: 14px; padding: 6px 12px; cursor: pointer; border: 1px solid #374151; background: #1f2937; color: #fff; margin-left: 20px;">Jira
        Config</button>
    </nav>
  </header>
  <main class="container">
    <div id="view-run">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <h1 style="margin: 0;">Visual Testing Studio</h1>
        <div style="display: flex; align-items: center; gap: 15px;">
          <button id="nav-clear" class="btn-reject" style="font-size: 14px; padding: 6px 12px; cursor: pointer;"
            onclick="window.location.reload()">Clear</button>
          <a href="#" id="nav-history" style="color: var(--accent); text-decoration: none; font-weight: 500;">History
            &rarr;</a>
        </div>
      </div>
      <form id="cmpForm">
        <label>Figma PNG</label>
        <div class="file-upload-wrapper" id="drop-zone">
          <input type="file" id="figma" name="figma_png" accept="image/png" required />
          <div class="file-upload-content">
            <span class="file-upload-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
              </svg>
            </span>
            <div id="file-text" class="file-upload-text">Click or Drop Figma PNG here</div>
          </div>
        </div>

        <label>Stage URL
          <input type="url" id="url" name="stage_url" placeholder="https://staging.example.com/page" required />
        </label>

        <div class="row">
          <label>Viewport
            <select name="viewport" id="viewport">
              <option value="desktop">Desktop (1366x768)</option>
              <option value="mobile">Mobile (390x844)</option>
              <option value="1280x800">1280x800</option>
              <option value="1440x900" selected>1440x900</option>
              <option value="1920x1080">1920x1080</option>
            </select>
          </label>

          <label>Noise Level (Tolerance)
            <select name="noise_tolerance" id="noise_tolerance">
              <option value="strict">Strict (High Sensitivity)</option>
              <option value="medium" selected>Medium (Standard)</option>
              <option value="relaxed">Relaxed (Low Sensitivity)</option>
            </select>
          </label>



          <label>Pass Threshold (SSIM)
            <input type="number" id="threshold" name="threshold" min="0.5" max="0.99" step="0.01" value="0.85" />
          </label>
        </div>

        <details
          style="margin-bottom: 20px; border: 1px solid #e0e0e0; padding: 12px; border-radius: 8px; background: #fafafa;">
          <summary style="cursor: pointer; font-weight: 600; color: #444;">Advanced Options ⚙️</summary>
          <div style="margin-top: 15px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Ignore Elements (CSS Selectors)
              <span style="font-weight: normal; color: #666; font-size: 0.9em;">(Hide dynamic content like ads,
                popups)</span>
              <textarea name="ignore_selectors" id="ignore_selectors" rows="3"
                placeholder=".ad-banner, #cookie-consent, .timestamp"
                style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 8px; margin-top: 5px; font-family: monospace;"></textarea>
            </label>

            <div style="margin-top: 10px;">
              <label style="display: block; margin-bottom: 4px; font-weight: 500;">Wait Time (ms)</label>
              <input type="number" name="wait_time" id="wait_time" value="1000" min="0" step="100"
                style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
              <span style="color: #666; font-size: 0.9em; margin-left: 10px;">(Wait for animations/loading)</span>
            </div>

            <div style="margin-top: 15px;">
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="highlight_diffs" checked style="margin-right: 8px; transform: scale(1.2);">
                <span style="font-weight: 500;">Highlight Differences</span>
              </label>
              <span style="display: block; color: #666; font-size: 0.9em; margin-left: 24px;">(Draw red boxes and
                overlay on differences)</span>
            </div>
          </div>
        </details>

        <button type="submit">Compare</button>
      </form>

      <div id="loader" class="loader-container hidden">
        <div class="progress-bar-bg">
          <div id="progressFill" class="progress-bar-fill"></div>
        </div>
        <div id="statusText" class="status-text">0% - Starting...</div>
      </div>

      <section id="result" class="hidden">
        <h2>Result</h2>
        <div id="metrics"></div>
        <div id="actions" class="actions hidden">
          <button id="btnApprove" class="btn-approve">Approve & Save</button>
          <button id="btnReject" class="btn-reject">Reject</button>
        </div>
        <div class="downloads">
          <a id="dl_overlay" href="#" download>Download Diff Overlay (PNG)</a>
          <a id="dl_heatmap" href="#" download>Download Diff Heatmap (PNG)</a>
          <a id="dl_aligned" href="#" download>Download Aligned Stage (PNG)</a>
          <a id="dl_report" href="#" download>Download Report (PDF)</a>
        </div>
        <div id="previews" class="grid"></div>
      </section>
    </div>

    <div id="view-history" class="hidden">
      <h1>Test History</h1>
      <table>
        <thead>
          <tr>
            <th width="40"><input type="checkbox" id="selectAll" onclick="toggleAll(this)"></th>
            <th>Date</th>
            <th>ID</th>
            <th>Status</th>
            <th>Review</th>
            <th>SSIM</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="history-list"></tbody>
      </table>
      <div id="pagination"
        style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;"></div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <!-- Modals -->
    <div id="jira-config-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Jira Configuration</h3>
        <label>Server URL <input type="text" id="jira-server" placeholder="https://your-domain.atlassian.net"></label>
        <label>Email <input type="email" id="jira-email" placeholder="email@example.com"></label>
        <label>API Token <input type="password" id="jira-token" placeholder="API Token"></label>
        <label>Project Key <input type="text" id="jira-project" placeholder="PROJ"></label>
        <div class="modal-actions">
          <button id="btnSaveJira">Save & Test</button>
          <button onclick="document.getElementById('jira-config-modal').classList.add('hidden')"
            class="btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <div id="jira-report-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Report to Jira</h3>
        <label>Summary <input type="text" id="jira-summary"></label>
        <label>Description <textarea id="jira-desc" rows="5"></textarea></label>
        <div class="modal-actions">
          <button id="btnSendJira">Create Issue</button>
          <button onclick="document.getElementById('jira-report-modal').classList.add('hidden')"
            class="btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

  </main>

  <script src="/static/app.js"></script>
  <script src="/static/jira_integration.js"></script>
</body>

</html>